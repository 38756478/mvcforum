@model MVCForum.Website.ViewModels.IndexCategoryViewModel
@{
    ViewBag.Title = Html.Raw(Html.LanguageString("Category.MainIndexHeading"));
}
@section side
{
    @Html.Action("SideSearch", "Search")
    @Html.Action("PopularTags", "Tag")
    @Html.Action("CurrentWeekHighPointUsers", "Point")
}

<h2>@ViewBag.Title</h2>

<div class="row categoryindex">

    @foreach (var cat in Model.Categories)
    {
        var topicCount = cat.Topics.Count;
        var latestTopicInCategory = cat.Topics.OrderByDescending(x => x.LastPost.DateCreated).FirstOrDefault();
        var postCount = cat.Topics.SelectMany(x => x.Posts).Count();
        
        <div class="span9 categorydetails">
            <h2><a href="@cat.NiceUrl">@Html.Raw(cat.Name)</a></h2>
            <p>@Html.Raw(cat.Description)</p>
            <div class="row categorydetailsfooter">
                <div class="span1">
                @if(Html.Settings().EnableRSSFeeds)
                {
                    <a title="@Html.LanguageString("Home.Rss")" href="@Url.Action("CategoryRss", "Category", new { slug = cat.Slug })" class="rsssubscribe">
                        @Html.LanguageString("Home.Rss")
                    </a>   
                } 
                </div>
                <div class="span1">
                    @topicCount discussions
                </div>
                <div class="span1">
                    @postCount comments
                </div>
                <div class="span6">
                    @if (latestTopicInCategory != null)
                    {
                        <text>
                               Most recent: @Html.Raw(latestTopicInCategory.Name) @Html.Raw(string.Format(Html.LanguageString("Topic.StartedBy"), DatesUI.GetPrettyDate(latestTopicInCategory.CreateDate.ToString()), latestTopicInCategory.User.UserName))
                        </text>
                    }
                </div>
            </div>
        </div>
    }

</div>
